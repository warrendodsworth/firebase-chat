!function(){"use-strict";angular.module("app",["ngRoute","ngAnimate","firebase","ui.bootstrap"]),angular.module("app").run(["$rootScope","$firebaseAuth",function(e,t){}]).config(["$httpProvider",function(e){var t={apiKey:"AIzaSyC9xO8omc7TxZZ0n4SOQW3bpE-uRryaVD4",authDomain:"dazzling-fire-5094.firebaseapp.com",databaseURL:"https://dazzling-fire-5094.firebaseio.com/",storageBucket:"gs://dazzling-fire-5094.appspot.com"};firebase.initializeApp(t)}])}(),function(){"use-strict";function e(e){e.when("/",{templateUrl:"_home/home.html",controller:"home",resolve:{currentAuth:["$firebaseAuth",function(e){return e().$requireSignIn()}]}}).when("/chat/:id",{templateUrl:"_home/chat.html",controller:"chat",resolve:{currentAuth:["$firebaseAuth",function(e){return e().$waitForSignIn()}]}}).when("/manage",{templateUrl:"_account/manage.html",controller:"account.manage",resolve:{currentAuth:["$firebaseAuth",function(e){return e().$waitForSignIn()}]}}).when("/login",{templateUrl:"_account/login.html",controller:"account.login"}).otherwise("/login")}angular.module("app").run(["$rootScope","$location",function(e,t){e.$on("$routeChangeError",function(e,o,a,n){"AUTH_REQUIRED"===n&&t.path("/home")})}]).config(["$routeProvider",e])}(),function(){"use strict";function e(e,t,o,a){var n=e,r=(firebase.auth(),new firebase.auth.FacebookAuthProvider);r.addScope("email,user_likes"),n.facebookLogin=function(){o().$signInWithRedirect(r)}}angular.module("app").controller("account.login",e),e.$inject=["$scope","$location","$firebaseAuth","_account"]}(),angular.module("app").factory("_profile",["$firebaseObject","$firebaseAuth",function(e,t){return function(t){var o=firebase.database().ref("users/"+t);return e(o)}}]).controller("account.manage",["$scope","$routeParams","_profile","currentAuth",function(e,t,o,a){var n=firebase.auth().currentUser;_profile(n.uid).$bindTo(e,"profile")}]),function(){"use strict";function e(e,t,o){var a={},n=(firebase.auth(),firebase.database()),r=n.ref(".info/connected");return a.auth={},o().$onAuthStateChanged(function(t){if(t){var o=n.ref("users/"+t.uid);o.once("value",function(e){var n=!e.exists();if(n)t.providerData.forEach(function(e){"facebook.com"==e.providerId&&(o.set({name:e.displayName,email:e.email,photoURL:e.photoURL}),a.auth.name=e.displayName,a.auth.email=e.email,a.auth.photoURL=e.photoURL)});else{var r=e.val();a.auth.name=r.name,a.auth.email=r.email,a.auth.photoURL=r.photoURL}});var i=n.ref("presence/"+t.uid);r.on("value",function(e){e.val()&&(i.onDisconnect().set(firebase.database.ServerValue.TIMESTAMP),i.set(!0))}),console.log("svc: user logged in"),e.path("/")}else console.log("svc: not logged in"),e.path("/login")}),a.logout=function(){return o().$signOut(),a.auth={},a.auth},a}angular.module("app").factory("_account",e),e.$inject=["$location","$rootScope","$firebaseAuth"]}();